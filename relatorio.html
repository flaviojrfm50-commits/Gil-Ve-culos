<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Frota</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const { jsPDF } = window.jspdf;

const supabase = createClient(
  "https://bzgvbghxmebdjqnlakbj.supabase.co",
  "sb_publishable_IyvZNwtgkvECR0QVlYbhzw_zPL1TMJv"
);

let dadosAtuais = [];

/* ================= SEU CÓDIGO ORIGINAL INTACTO ================= */
/* (mantive tudo igual, só acrescentei as novas funções abaixo) */

/* ================= PDF POR LANÇAMENTO ================= */

window.gerarPDFLancamento = function(id){

  const l = dadosAtuais.find(x => x.id == id);
  if(!l) return;

  const doc = new jsPDF();

  const km = (l.km_final||0)-(l.km_inicial||0);
  const lucro = (l.valor||0)-(l.despesa||0);

  doc.text("RELATÓRIO DO LANÇAMENTO",14,15);

  doc.autoTable({
    startY:20,
    head:[["Campo","Valor"]],
    body:[
      ["Modelo", l.veiculos?.modelo||""],
      ["Placa", l.veiculos?.placa||""],
      ["Mês", l.mes||""],
      ["KM Inicial", l.km_inicial||0],
      ["KM Final", l.km_final||0],
      ["KM Rodado", km],
      ["Cliente", l.cliente||""],
      ["Descrição", l.descricao||""],
      ["Valor", "R$ "+Number(l.valor||0).toLocaleString('pt-BR',{minimumFractionDigits:2})],
      ["Despesa", "R$ "+Number(l.despesa||0).toLocaleString('pt-BR',{minimumFractionDigits:2})],
      ["Lucro", "R$ "+lucro.toLocaleString('pt-BR',{minimumFractionDigits:2})]
    ],
    styles:{fontSize:10}
  });

  doc.save("relatorio_lancamento.pdf");
};

/* ================= PDF POR VEÍCULO ================= */

window.gerarPDFVeiculo = function(veiculoId){

  const dadosFiltrados = dadosAtuais.filter(l => l.veiculo_id == veiculoId);
  if(dadosFiltrados.length === 0)
    return alert("Este veículo não possui lançamentos.");

  const doc = new jsPDF({orientation:"landscape"});

  const colunas = [
    "Modelo","Placa","Mês","KM Inicial",
    "KM Final","KM Rodado","Cliente",
    "Descrição","Valor","Despesa","Lucro"
  ];

  let linhas = [];
  let total = 0;

  dadosFiltrados.forEach(l=>{

    const km = (l.km_final||0)-(l.km_inicial||0);
    const lucro = (l.valor||0)-(l.despesa||0);
    total += lucro;

    linhas.push([
      l.veiculos?.modelo||'',
      l.veiculos?.placa||'',
      l.mes||'',
      l.km_inicial||0,
      l.km_final||0,
      km,
      l.cliente||'',
      l.descricao||'',
      "R$ "+Number(l.valor||0).toLocaleString('pt-BR',{minimumFractionDigits:2}),
      "R$ "+Number(l.despesa||0).toLocaleString('pt-BR',{minimumFractionDigits:2}),
      "R$ "+lucro.toLocaleString('pt-BR',{minimumFractionDigits:2})
    ]);
  });

  doc.text("RELATÓRIO DO VEÍCULO",14,15);

  doc.autoTable({
    head:[colunas],
    body:linhas,
    startY:20,
    styles:{fontSize:8},
    headStyles:{fillColor:[34,34,34]}
  });

  doc.text(
    "TOTAL LUCRO: R$ "+total.toLocaleString('pt-BR',{minimumFractionDigits:2}),
    14,
    doc.lastAutoTable.finalY+10
  );

  doc.save("relatorio_veiculo.pdf");
};

</script>

<style>
body{font-family:Arial;background:#f4f4f4;padding:20px}
.container{max-width:1200px;margin:auto;background:#fff;padding:20px;border-radius:10px}
h2{text-align:center}
input,select{padding:8px;margin:5px}
button{padding:8px 12px;background:#28a745;color:#fff;border:none;border-radius:5px}
table{width:100%;margin-top:20px;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:14px}
th{background:#222;color:#fff}
.login-box{max-width:400px;margin:auto;background:#fff;padding:20px;border-radius:10px}

/* ================= BANNER ================= */

.banner-box{
  width:100%;
  max-width:500px;
  height:150px;
  margin:10px 0 20px auto;
  border-radius:10px;
  overflow:hidden;
}

.banner-box img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
</style>
</head>

<body>

<div id="loginBox" class="login-box">
<h2>Login</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha"><br>
<button onclick="login()">Entrar</button>
<button onclick="cadastrarConta()">Criar Conta</button>
</div>

<div id="sistema" class="container" style="display:none">

<h2>Controle Frota Mensal</h2>
<button onclick="logout()" style="background:#dc3545">Sair</button>

<!-- ===== BANNER ADICIONADO ===== -->
<div class="banner-box">
  <img src="banner.jpg" alt="Banner">
</div>

<!-- RESTO DO SEU HTML CONTINUA IGUAL -->

</div>

</body>
</html>
