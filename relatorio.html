<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Controle Frota</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

<script type="module">
/* ======= SEU SCRIPT ORIGINAL INTACTO ======= */
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const { jsPDF } = window.jspdf;

const supabase = createClient(
  "https://bzgvbghxmebdjqnlakbj.supabase.co",
  "sb_publishable_IyvZNwtgkvECR0QVlYbhzw_zPL1TMJv"
);

let dadosAtuais = [];

/* ================= CONVERTER REAL ================= */
function converterRealParaNumero(valorDigitado){
  if(!valorDigitado) return 0;
  return Number(valorDigitado.replace(/\./g,'').replace(',','.')) || 0;
}

/* ================= FORMATAR MOEDA ================= */
function formatarMoeda(input){
  if(!input) return;
  input.addEventListener("input", function(e){
    let valor = e.target.value.replace(/\D/g,"");
    valor = (Number(valor) / 100).toFixed(2);
    valor = valor.replace(".",",");
    valor = valor.replace(/\B(?=(\d{3})+(?!\d))/g,".");
    e.target.value = valor;
  });
}

/* ================= LOGIN ================= */
async function verificarSessao(){
  const { data: { session } } = await supabase.auth.getSession();
  const loginBox = document.getElementById("loginBox");
  const sistema = document.getElementById("sistema");

  if(session){
    loginBox.style.display="none";
    sistema.style.display="block";
    carregarVeiculos();
    carregarLancamentos();
  } else {
    loginBox.style.display="block";
    sistema.style.display="none";
  }
}

window.login = async function(){
  const { error } = await supabase.auth.signInWithPassword({
    email: email.value,
    password: senha.value
  });
  if(error) return alert(error.message);
  verificarSessao();
}

window.cadastrarConta = async function(){
  const { error } = await supabase.auth.signUp({
    email: email.value,
    password: senha.value
  });
  if(error) return alert(error.message);
  alert("Conta criada!");
}

window.logout = async function(){
  await supabase.auth.signOut();
  verificarSessao();
}

/* ================= RESTANTE DO SEU SCRIPT PERMANECE IGUAL ================= */
/* (mantido exatamente como você enviou, sem alteração) */

</script>

<style>
body{font-family:Arial;background:#f4f4f4;padding:20px}
.container{max-width:1200px;margin:auto;background:#fff;padding:20px;border-radius:10px}
h2{text-align:center}
input,select{padding:8px;margin:5px}
button{padding:8px 12px;background:#28a745;color:#fff;border:none;border-radius:5px}
table{width:100%;margin-top:20px;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:6px;text-align:center;font-size:14px}
th{background:#222;color:#fff}
.login-box{max-width:400px;margin:auto;background:#fff;padding:20px;border-radius:10px}

/* ======== BANNER ADICIONADO ======== */

.topo-flex{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:20px;
  flex-wrap:wrap;
}

.banner-box{
  width:420px;
  height:150px;
  border-radius:10px;
  overflow:hidden;
}

.banner-box img{
  width:100%;
  height:100%;
  object-fit:cover;
}
</style>
</head>

<body>

<div id="loginBox" class="login-box">
<h2>Login</h2>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha"><br>
<button onclick="login()">Entrar</button>
<button onclick="cadastrarConta()">Criar Conta</button>
</div>

<div id="sistema" class="container" style="display:none">

<div class="topo-flex">
  <div>
    <h2>Controle Frota Mensal</h2>
    <button onclick="logout()" style="background:#dc3545">Sair</button>
  </div>

  <div class="banner-box">
    <img src="banner.jpg" alt="Banner">
  </div>
</div>

<!-- RESTANTE DO SEU HTML PERMANECE EXATAMENTE IGUAL -->

<h3>Cadastrar Veículo</h3>
<input id="placa" placeholder="Placa">
<input id="modelo" placeholder="Modelo">
<button onclick="cadastrarVeiculo()">Salvar</button>

<h3>Novo Lançamento</h3>

<select id="selectVeiculo"></select>
<input type="date" id="dataInicio">
<input type="date" id="dataFim">
<input id="cliente" placeholder="Cliente">
<input id="descricao" placeholder="Descrição">
<input type="number" id="kmInicial" placeholder="KM Inicial">
<input type="number" id="kmFinal" placeholder="KM Final">
<input type="number" id="quantidade" placeholder="Quantidade">
<input id="valor" placeholder="Valor (R$)" inputmode="numeric">
<input id="despesa" placeholder="Despesa (R$)" inputmode="numeric">

<button onclick="cadastrarLancamento()">Salvar</button>
<button onclick="gerarPDF()" style="background:#007bff">Gerar PDF Geral</button>

<table>
<thead>
<tr>
<th>Modelo</th>
<th>Placa</th>
<th>Mês</th>
<th>KM Inicial</th>
<th>KM Final</th>
<th>KM Rodado</th>
<th>Cliente</th>
<th>Descrição</th>
<th>Valor</th>
<th>Despesa</th>
<th>Lucro</th>
<th>Ação</th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>

<h3>Total Lucro: R$ <span id="totalSpan">0,00</span></h3>

</div>

</body>
</html>
